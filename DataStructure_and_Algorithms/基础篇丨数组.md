## 为什么很多编程语言中数组都从0开始编号？

### 1.如何实现随机访问?
- 在每一种编程语言中，基本都会有数组这种数据类型。但是数组不仅仅是一种编程语言的数据类型，还是一种最基础的数据结构。

#### 1.1数组的定义
- 数组是一种线性表数据结构，它用一组连续的内存空间，来存储一组具有相同类型的数据。

#### 1.2线性表
- 线性表就是数据排成像一条线一样的结构。每个线性表上的数据最多只有前、后两个方向。
- 数组、链表、队列、栈也是线性表结构。
![avatar](../images/线性表结构.jpg)

#### 1.3非线性表
- 非线性表中，数据之间并不是简单的前后关系。
- 二叉树、堆、图就是非线性表。
![avatar](../images/非线性表结构.jpg)

#### 1.4随机访问
- 由于连续的内存空间和相同类型的数据。数组才有了一个特性：随机访问。但同时也让数组的很多操作变得低效。
- 比如：要想在数组中删除、插入一个数据，为了保证连续性，就需要做大量的数据搬移工作。

#### 1.5如何根据下标随机访问数组元素
- 计算机给数组a[10]分配一块连续内存空间1000~1039，内存块的首地址为base_address=1000
- 计算机会给每个内存单元分配一个地址，计算机通过地址来访问内存中的数据。当计算机需要随机访问数组中的某个元素时，它会首先通过下面的寻址公式，计算出该元素存储的内存地址：
`a[i]_address = base_address + i * data_type_size
`
![avatar](../images/数组.jpg)

#### 1.6数组与链表的区别
- 链表适合插入、删除，时间复杂度O(1)；数组支持随机访问，根据下标随机访问的时间复杂度为 O(1)。

### 2.低效的"插入"和"删除"

#### 2.1插入
- 假设数组的长度为n，如果我们需要将一个数据插入到数组中的第 k 个位置。为了把第 k 个位置腾出来，给新来的数据，我们需要将第 k～n 这部分的元素都顺序地往后挪一位。
- 如果数组中的数据是有序的，我们在某个位置插入一个新的元素时，就必须按照刚才的方法搬移 k 之后的数据。
- 但是，如果数组中存储的数据并没有任何规律，数组只是被当作一个存储数据的集合。在这种情况下，如果要将某个数组插入到第 k 个位置，直接将第 k 位的数据搬移到
数组元素的最后，把新的元素直接放入第 k 个位置即可。
![avatar](../images/数组插入.jpg)

#### 2.2删除
- 为了避免 d，e，f，g，h 这几个数据会被搬移三次，我们可以先记录下已经删除的数据。每次的删除操作并不是真正地搬移数据，只是记录数据已经被删除。当数组没有更多空间存储数据时，我们再触发执行一次真正的删除操作，这样就大大减少了删除操作导致的数据搬移
- 这就是JVM 标记清除垃圾回收算法的核心思想
- 很多时候我们并不是要去死记硬背某个数据结构或者算法，而是要学习它背后的思想和处理技巧，这些东西才是最有价值的。
![avatar](../images/数组删除.jpg)

### 3.警惕数组访问越界问题
- 在 C 语言中，只要不是访问受限的内存，所有的内存空间都是可以自由访问的。
- 数组越界在 C 语言中是一种未决行为，并没有规定数组访问越界时编译器应该如何处理。因为，访问数组的本质就是访问一段连续内存，只要数组通过偏移计算得到的内存地址是可用的，那么程序就可能不会报任何错误。

### 4.容器能否完全替代数组？

#### 4.1ArrayList的优势
- ArrayList 最大的优势就是可以将很多数组操作的细节封装起来。
- 它还有一个优势，就是支持动态扩容。每次存储空间不够的时候，它都会将空间自动扩容为 1.5 倍大小。
- 因为扩容操作涉及内存申请和数据搬移，是比较耗时的。所以，如果事先能确定需要存储的数据大小，最好在创建 ArrayList的时候事先指定数据大小。

#### 4.2作者的经验
- Java ArrayList 无法存储基本类型，比如 int、long，需要封装为 Integer、Long 类，而 Autoboxing、Unboxing 则有一定的性能消耗，所以如果特别关注性能，或者希望使用基本类型，就可以选用数组。
- 如果数据大小事先已知，并且对数据的操作非常简单，用不到ArrayList 提供的大部分方法，也可以直接使用数组。
- 对于业务开发，直接使用容器就足够了。
- 做一些非常底层的开发，比如开发网络框架，性能的优化需要做到极致，这个时候数组就会优于容器，成为首选。

### 5.解答开篇
- 数组存储的内存模型上来看，“下标”最确切的定义应该是“偏移（offset）”。
- 如果用 a 来表示数组的首地址，a[0] 就是偏移为 0 的位置，也就是首地址，a[k] 就表示偏移k个type_size 的位置，所以计算 a[k] 的内存地址只需要用这个公式：
`a[k]_address = base_address + k * type_size
`
- 主要原因：C 语言设计者用 0 开始计数数组下标，之后的 Java、JavaScript 等高级语言都效仿了 C 语言。
- 实际上，很多语言中数组也并不是从0开始计数的，比如Matlab。甚至还有一些语言支持负数下标，比如 Python。

### 6.小结
- 数组：最基础、最简单的数据结构。
- 数组用一块连续的内存空间，来存储相同类型的一组数据，最大的特点就是支持随机访问，但插入、删除操作也因此变得比较低效，平均情况时间复杂度为 O(n)。
- 在平时的业务开发中，我们可以直接使用编程语言提供的容器类，但是，如果是特别底层的开发，直接使用数组可能会更合适。
